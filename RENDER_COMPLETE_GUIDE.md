# üöÄ Render.com Deployment Guide - Complete Setup

This guide will help you deploy your Assignment Submission System to Render.com with PostgreSQL database.

---

## ‚úÖ Prerequisites Completed

- [x] PostgreSQL driver added to both services
- [x] `application-prod.properties` updated for PostgreSQL
- [x] Build scripts created (`build.sh`)
- [x] `render.yaml` blueprint file created
- [x] Code pushed to GitHub

---

## üìã Deployment Steps

### Step 1: Create Render.com Account

1. Go to [https://render.com](https://render.com)
2. Sign up with your GitHub account (recommended)
3. Authorize Render to access your repositories

### Step 2: Deploy Using Blueprint (One-Click)

1. Go to your Render Dashboard: [https://dashboard.render.com](https://dashboard.render.com)
2. Click **"New"** ‚Üí **"Blueprint"**
3. Connect your GitHub repository:
   - Repository: `wolfieexd/Assignment-Submission-and-Project-Tracking-System-using-Spring-Boot`
   - Branch: `main`
4. Render will detect `render.yaml` automatically
5. Click **"Apply"** to deploy all services

**What gets deployed:**
- ‚úÖ PostgreSQL Database (assignment-db)
- ‚úÖ User Service (Java 21 backend)
- ‚úÖ Submission Service (Java 21 backend)
- ‚úÖ Frontend (React static site)

### Step 3: Configure Environment Variables

After deployment, you need to set these environment variables:

#### For `user-service`:
```env
JWT_SECRET=<auto-generated-by-render>
CORS_ALLOWED_ORIGINS=https://assignment-frontend.onrender.com
DATABASE_URL=<auto-populated-from-db>
DB_USERNAME=<auto-populated-from-db>
DB_PASSWORD=<auto-populated-from-db>
```

#### For `submission-service`:
```env
JWT_SECRET=<use-same-as-user-service>
CORS_ALLOWED_ORIGINS=https://assignment-frontend.onrender.com
DATABASE_URL=<auto-populated-from-db>
DB_USERNAME=<auto-populated-from-db>
DB_PASSWORD=<auto-populated-from-db>
FILE_UPLOAD_DIR=/opt/render/project/uploads
```

#### For `assignment-frontend`:
```env
VITE_API_USER_URL=https://user-service.onrender.com
VITE_API_SUBMISSION_URL=https://submission-service.onrender.com
```

**Important:** Make sure both backend services use the **same JWT_SECRET**!

### Step 4: Verify Deployment

1. Wait for all services to build and deploy (5-10 minutes)
2. Check service status in Render Dashboard
3. Test the endpoints:

```bash
# User Service Health Check
curl https://user-service.onrender.com/actuator/health

# Submission Service Health Check
curl https://submission-service.onrender.com/actuator/health

# Frontend
curl https://assignment-frontend.onrender.com
```

### Step 5: Test the Application

1. Open `https://assignment-frontend.onrender.com`
2. Register a new user (Faculty)
3. Login with credentials
4. Test assignment creation and submission

---

## üîß Manual Deployment Alternative

If you prefer manual deployment instead of using the blueprint:

### Deploy PostgreSQL Database

1. Dashboard ‚Üí **New** ‚Üí **PostgreSQL**
2. Name: `assignment-db`
3. Database Name: `assignment_system`
4. User: `assignment_user`
5. Region: `Oregon` (or nearest)
6. Plan: **Free**
7. Click **Create Database**
8. Copy the **Internal Database URL** (starts with `postgresql://`)

### Deploy User Service

1. Dashboard ‚Üí **New** ‚Üí **Web Service**
2. Connect repository: `wolfieexd/Assignment-Submission-and-Project-Tracking-System-using-Spring-Boot`
3. Configure:
   - **Name:** `user-service`
   - **Region:** Oregon
   - **Branch:** main
   - **Root Directory:** `backend/user-service`
   - **Runtime:** Java 21
   - **Build Command:** `chmod +x build.sh && ./build.sh`
   - **Start Command:** `java -Dserver.port=$PORT -Dspring.profiles.active=prod -jar target/user-service-1.0.0.jar`
   - **Plan:** Free
4. Add Environment Variables:
   ```
   SPRING_PROFILES_ACTIVE=prod
   DATABASE_URL=<paste-internal-database-url>
   DB_USERNAME=<from-database>
   DB_PASSWORD=<from-database>
   JWT_SECRET=<generate-random-base64-string>
   JWT_EXPIRATION=3600000
   CORS_ALLOWED_ORIGINS=https://assignment-frontend.onrender.com
   ```
5. Click **Create Web Service**

### Deploy Submission Service

1. Dashboard ‚Üí **New** ‚Üí **Web Service**
2. Connect same repository
3. Configure:
   - **Name:** `submission-service`
   - **Region:** Oregon
   - **Branch:** main
   - **Root Directory:** `backend/submission-service`
   - **Runtime:** Java 21
   - **Build Command:** `chmod +x build.sh && ./build.sh`
   - **Start Command:** `java -Dserver.port=$PORT -Dspring.profiles.active=prod -jar target/submission-service-1.0.0.jar`
   - **Plan:** Free
4. Add Environment Variables (use **same JWT_SECRET** as user-service):
   ```
   SPRING_PROFILES_ACTIVE=prod
   DATABASE_URL=<paste-internal-database-url>
   DB_USERNAME=<from-database>
   DB_PASSWORD=<from-database>
   JWT_SECRET=<same-as-user-service>
   JWT_EXPIRATION=3600000
   FILE_UPLOAD_DIR=/opt/render/project/uploads
   CORS_ALLOWED_ORIGINS=https://assignment-frontend.onrender.com
   ```
5. Click **Create Web Service**

### Deploy Frontend

1. Dashboard ‚Üí **New** ‚Üí **Static Site**
2. Connect same repository
3. Configure:
   - **Name:** `assignment-frontend`
   - **Region:** Oregon
   - **Branch:** main
   - **Build Command:** `chmod +x build.sh && ./build.sh`
   - **Publish Directory:** `dist`
4. Add Environment Variables:
   ```
   NODE_VERSION=20
   VITE_API_USER_URL=https://user-service.onrender.com
   VITE_API_SUBMISSION_URL=https://submission-service.onrender.com
   ```
5. Click **Create Static Site**

---

## üéØ Important Notes

### Free Tier Limitations
- ‚úÖ **PostgreSQL:** 1GB storage, 97 connection limit
- ‚úÖ **Web Services:** 512MB RAM, spins down after 15 min inactivity
- ‚úÖ **Static Site:** 100GB bandwidth/month
- ‚ö†Ô∏è **Cold starts:** First request may take 30-60 seconds

### Database Initialization
The first deployment will create tables automatically because we set:
```properties
spring.jpa.hibernate.ddl-auto=update
```

### CORS Configuration
Update `CORS_ALLOWED_ORIGINS` after getting your frontend URL:
```
https://assignment-frontend.onrender.com
```

### File Uploads
Files are stored in `/opt/render/project/uploads` directory. Note: Files are ephemeral on free tier and will be lost during redeployments.

**For persistent file storage, consider:**
- AWS S3
- Cloudinary
- Render Disk (paid)

---

## üîç Troubleshooting

### Service Won't Start
1. Check logs: Dashboard ‚Üí Service ‚Üí Logs
2. Verify environment variables are set correctly
3. Ensure PostgreSQL is running
4. Check build logs for errors

### Database Connection Failed
1. Verify `DATABASE_URL` format: `postgresql://user:password@host:port/database?sslmode=require`
2. Check database is in same region as services
3. Use **Internal Database URL** (not External)

### CORS Errors
1. Update `CORS_ALLOWED_ORIGINS` with actual frontend URL
2. Redeploy backend services after updating environment variables

### JWT Errors
1. Ensure both backends use **identical JWT_SECRET**
2. JWT_SECRET must be Base64 encoded string

---

## üîÑ Updating Your Application

### Push Updates
```bash
git add .
git commit -m "Update: description of changes"
git push origin main
```

Render will automatically detect changes and redeploy.

### Manual Redeploy
Dashboard ‚Üí Service ‚Üí **Manual Deploy** ‚Üí Deploy latest commit

---

## üìä Monitoring

### View Logs
Dashboard ‚Üí Service ‚Üí Logs (real-time)

### Health Checks
- User Service: `https://user-service.onrender.com/actuator/health`
- Submission Service: `https://submission-service.onrender.com/actuator/health`

### Metrics
Dashboard ‚Üí Service ‚Üí Metrics (CPU, Memory, Response Time)

---

## üéâ Deployment Complete!

Your application URLs:
- **Frontend:** `https://assignment-frontend.onrender.com`
- **User Service:** `https://user-service.onrender.com`
- **Submission Service:** `https://submission-service.onrender.com`

**Next Steps:**
1. Test user registration
2. Test login functionality
3. Test assignment creation (Faculty)
4. Test assignment submission (Student)
5. Monitor logs for any errors

---

## üìû Support Resources

- Render Docs: https://render.com/docs
- Community Forum: https://community.render.com
- Status Page: https://status.render.com

**Enjoy your production deployment! üöÄ**
